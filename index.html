<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>WangPangPang | be hangry be foolish</title>

  
  <meta name="author" content="王琪">
  

  
  <meta name="description" content="write I want to">
  

  
  <meta name="keywords" content="ios">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="WangPangPang"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="WangPangPang" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">WangPangPang</a>
    </h1>
    <p class="site-description">be hangry be foolish</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2018/07/20/UISearchController的坑/"><span>UISearchController的坑</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/20/UISearchController的坑/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-20T02:45:00.000Z">
          2018-07-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//自定义的搜索结果controller</span><br><span class="line">  JXSearchResultController *resultVC = [[JXSearchResultController alloc]init];</span><br><span class="line">    resultVC.delegate = self;</span><br><span class="line">    //创建searchcontroller</span><br><span class="line">    UISearchController *searchVC = [[UISearchController alloc]initWithSearchResultsController:resultVC];</span><br><span class="line">    //隐藏导航栏</span><br><span class="line">    searchVC.hidesNavigationBarDuringPresentation = YES;</span><br><span class="line">    searchVC.searchBar.delegate = resultVC;</span><br><span class="line">    self.searchVC = searchVC;</span><br><span class="line">    //改变searchbar的背景色</span><br><span class="line">    searchVC.searchBar.barTintColor = White_Color;</span><br><span class="line">    //改变searchbar输入框背景色</span><br><span class="line">    UIView *searchTextField = [[[searchVC.searchBar.subviews firstObject]subviews]lastObject];</span><br><span class="line">    searchTextField.backgroundColor = Backgourd_Color;</span><br><span class="line">    //</span><br><span class="line">    [searchVC.searchBar sizeToFit];</span><br><span class="line">    //NO表示UISearchController在present时，可以覆盖当前controller。默认为NO</span><br><span class="line">    searchView = searchVC.searchBar;</span><br><span class="line">    [searchBgView addSubview:searchView];</span><br><span class="line">    </span><br><span class="line">    searchBgView.frame = CGRectMake(0, naviHeight, kMAINScreenWidth, searchVC.searchBar.height);</span><br><span class="line">    searchView.frame = searchView.bounds;</span><br><span class="line">    mainView.frame = CGRectMake(0, naviHeight + searchVC.searchBar.height, kMAINScreenWidth, kMAINScreenHeight - kTabNavHeight - kNavigationRealHeight);</span><br><span class="line">    //当前显示controller设为rootcontroller作为跳转使用</span><br><span class="line">    self.definesPresentationContext = YES;</span><br></pre></td></tr></table></figure>
<p>说他坑主要集中在获取他的height上，需要先sizetofit确定frame后获取height。<br>第二坑是searchVC.definesPresentationContext设为No后要手动把active设为no才能跳转<br>第三坑是改变背景色，这样方式比较暴力，在想没有更好的办法<br>第四坑是直接searchBgView=searchVC.searchBar无效，要在view上再加一层view，将他设为<br>searchVC.searchBar才有效。<br>第五坑搜索结果后push新页面时搜索结果页在最上面，需要设置self.definesPresentationContext = YES;</p>
<p>为了要个UISearchController的动画效果，踩得坑还真是不少。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/07/18/UITest/"><span>UITest</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/18/UITest/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-18T06:46:42.000Z">
          2018-07-18
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>运行程序，点击UITest.m， 点击红点开始录制你要的操作，然后运行测试代码看是否通过</p>
<p>录制过程中的一些代码报错的地方需要手动替换，Unicode编码要自己替换成汉字。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/07/17/日历/"><span>日历</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/17/日历/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-17T03:27:06.000Z">
          2018-07-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最近有个任务是写日历，记录一下遇到的坑，获取星期返回的数字，从星期日开始，星期六结束，对应数字1-7.</p>
<p>计算“yyyy-MM-dd”的时间戳是在当天0点，如果要获取这天结尾需要+1天。</p>
<p>遍历整个日历是直接遍历整个collectionview的indexpath，不要分区遍历，不然头尾衔接不上</p>
<p>关于合并两个相邻日期的详情文字，只有覆盖一层view，通过遍历整个collectionview的indexpath，获取需要遍历的indexpath，然后计算坐标，在到maskview上添加合并的文字，并取消collectionview里的文字。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/07/16/遇到的坑/"><span>遇到的坑</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/16/遇到的坑/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-16T05:49:30.000Z">
          2018-07-16
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>在用AVPlayer和AVAduioPlayer时，遇到有一些音频获取的时长与真实时长有差异，而且这个bug只在iOS11以下存在，应该是苹果接口的问题</p>
<p>解决方案有两个<br>一、重新编码解码该音频<br>二、用流媒体播放器</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/05/31/编译ijkplayer遇到的坑/"><span>编译ijkplayer遇到的坑</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/05/31/编译ijkplayer遇到的坑/" rel="bookmark">
        <time class="entry-date published" datetime="2018-05-31T00:46:25.000Z">
          2018-05-31
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>如果要支持https的播放需要编译openssl这个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 进入到刚刚新建的文件夹内 </span><br><span class="line">cd ~/Desktop/ijkplayer/ </span><br><span class="line"># 获取ijkplayer源码 </span><br><span class="line">git clone https://github.com/Bilibili/ijkplayer.git ijkplayer-ios </span><br><span class="line"># 进入源码目录 </span><br><span class="line">cd ijkplayer-ios </span><br><span class="line"># 切换分支 (目前为k0.8.8, 可以自行去GitHub查看最新版本号) </span><br><span class="line">git checkout -B latest k0.8.8</span><br><span class="line"></span><br><span class="line">./init-ios.sh</span><br><span class="line">./init-openssl.sh</span><br><span class="line"></span><br><span class="line">cd ios </span><br><span class="line"># 在模块文件中添加一行配置 以启用 openssl 组件 </span><br><span class="line">echo &apos;export COMMON_FF_CFG_FLAGS=&quot;$COMMON_FF_CFG_FLAGS --enable-openssl&quot;&apos; &gt;&gt; ../config/module.sh ./compile-ffmpeg.sh clean</span><br><span class="line"></span><br><span class="line">./compile-openssl.sh all</span><br><span class="line"></span><br><span class="line"># 编译ffmpeg</span><br><span class="line">./compile-ffmpeg.sh all</span><br><span class="line"></span><br><span class="line">open IJKMediaPlayer/IJKMediaPlayer.xcodeproj</span><br><span class="line">#选择libcrypto.a和libssl.a加入库</span><br><span class="line">#在模拟器和真机分别编译</span><br><span class="line">#run模式切换为release</span><br><span class="line"></span><br><span class="line">#合并模拟器和真机的包</span><br><span class="line">lipo -create Release-iphoneos/IJKMediaFramework.framework/IJKMediaFramework Release-iphonesimulator/IJKMediaFramework.framework/IJKMediaFramework -output IJKMediaFramework</span><br></pre></td></tr></table></figure>
<p>依赖库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.	libc++.tbd ( 编译器选 gcc 的请导入 libstdc++.tbd )</span><br><span class="line">2.	libz.tbd</span><br><span class="line">3.	libbz2.tbd</span><br><span class="line">4.	AudioToolbox.framework</span><br><span class="line">5.	UIKit.framework</span><br><span class="line">6.	CoreGraphics.framework</span><br><span class="line">7.	AVFoundation.framework</span><br><span class="line">8.	CoreMedia.framework</span><br><span class="line">9.	CoreVideo.framework</span><br><span class="line">10.	MediaPlayer.framework</span><br><span class="line">11.	MobileCoreServices.framework</span><br><span class="line">12.	OpenGLES.framework</span><br><span class="line">13.	QuartzCore.framework</span><br><span class="line">14.	VideoToolbox.framework</span><br></pre></td></tr></table></figure></p>
<p>支持armv7 需要xcode7以下的编译，从官网下一个xcode7，让两个xcode并存，切换xcode<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo xcode-select -s /Applications/Xcode5.0.2/Xcode.app/Contents/Developer</span><br></pre></td></tr></table></figure></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/05/29/SVProgress替换默认图片/"><span>SVProgress替换默认图片</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/05/29/SVProgress替换默认图片/" rel="bookmark">
        <time class="entry-date published" datetime="2018-05-29T07:45:55.000Z">
          2018-05-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>美工给了个旋转图标，但是只有一张图，要在SVProgress里替换图片只有一个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[SVProgressHUD showImage:image status:text];</span><br></pre></td></tr></table></figure></p>
<p>如果只放一张图他是不会动的，所以需要一个gif动图效果才行，所以我把那张图片顺时针旋转了一圈，然后按角度等比例截图成新图片，组成一个动图添加进<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[UIImage animatedImageWithImages:images duration:2];</span><br></pre></td></tr></table></figure></p>
<p>这样就相当于它是转起来了</p>
<p>截图代码，我是转一圈设置的2s，由于屏幕的刷新频率是60，所以生成了120张图，但是好像60张也感觉不出明显的卡顿。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//将一张图片变成连续的动图</span><br><span class="line">+ (NSArray *)changeImageToArrayImage:(UIImage *)image &#123;</span><br><span class="line">    NSMutableArray *images = [[NSMutableArray alloc]init];</span><br><span class="line">    </span><br><span class="line">    NSInteger count = 120;</span><br><span class="line">    for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">        float angle = M_PI * 2 / count * i;</span><br><span class="line">        UIImage *newImage = [image imageByRotate:angle fitSize:NO];</span><br><span class="line">        [images addObject:newImage];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return images.copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/05/28/YYTextView修改UIMenuController/"><span>YYTextView修改UIMenuController</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/05/28/YYTextView修改UIMenuController/" rel="bookmark">
        <time class="entry-date published" datetime="2018-05-28T06:57:43.000Z">
          2018-05-28
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最新有一个新需求，要求用户把文章内容能加入到他的笔记里，但是不能复制外面，所以系统的复制粘贴功能要禁用，我就想到了用YYTextView来做选择复制的功能，但是他的功能没有自定义UIMenuController的接口，所以要改他的源码，所以稍微阅读了下YYTextView的源码，实现了自定义UIMenuController的功能。</p>
<p>第一步、在YYTextView.h文件里添加接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//自定义menu菜单</span><br><span class="line">@property (nonatomic, strong) NSArray&lt;UIMenuItem *&gt; *menuItems;</span><br><span class="line">//隐藏菜单 这两个是他自己隐藏的接口，暴露出来，有地方会用到</span><br><span class="line">- (void)_hideMenu;</span><br><span class="line">- (void)_hideMagnifier;</span><br><span class="line">//禁止所有的menu菜单</span><br><span class="line">@property (nonatomic, assign) BOOL forbidMenu;</span><br></pre></td></tr></table></figure>
<p>第二步，在.m里添加实现<br>在_showMenu这个方法里</p>
<p>在初始化menu的地方添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (self.menuItems.count &gt; 0) &#123;</span><br><span class="line">             menu.menuItems = self.menuItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个方法- (BOOL)canPerformAction:(SEL)action withSender:(id)sender里添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (self.forbidMenu == YES) &#123;</span><br><span class="line">     return NO;</span><br><span class="line"> &#125;</span><br><span class="line"> if (self.menuItems.count &gt; 0) &#123;</span><br><span class="line">     return NO;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>第三步，实现items</p>
<p>在你要用YYTextView的地方添加items</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UIMenuItem *cancelItem = [[UIMenuItem alloc]initWithTitle:@&quot;取消&quot; action:@selector(cancelMenuItem:)];</span><br><span class="line">   UIMenuItem *addNoteItem = [[UIMenuItem alloc]initWithTitle:@&quot;加入到笔记&quot; action:@selector(addNoteMenuItem:)];</span><br><span class="line">   textview.menuItems = @[cancelItem,addNoteItem];</span><br></pre></td></tr></table></figure>
<p>同样重写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)canPerformAction:(SEL)action withSender:(id)sender &#123;</span><br><span class="line">    if (action == @selector(cancelMenuItem:)) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125; else if (action == @selector(addNoteMenuItem:)) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return NO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后实现@selector(cancelMenuItem:) 和 @selector(addNoteMenuItem:) 方法就行了</p>
<p>效果:</p>
<p><img src="https://raw.githubusercontent.com/wqforever/wqforever.github.io/master/image/1527491847756.jpg" alt="Alt Text"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/04/29/yycache的坑/"><span>yycache的坑</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/04/29/yycache的坑/" rel="bookmark">
        <time class="entry-date published" datetime="2018-04-29T11:34:24.000Z">
          2018-04-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最近有个需求需要记录用过的viewcontroller，所以打算用yycache来缓存，然后发现缓存倒是缓存了，但是再取出来的viewcontroller的地址都变了，而且是每取一次变一次。</p>
<p>猜想是yycache在缓存或者取的时候做了一次copy操作，导致原来的地址变了，所以自己实现了一个简单的记录viewcontroller的方法</p>
<p>.h<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface JXMemoryCache : NSObject</span><br><span class="line"></span><br><span class="line">+ (instancetype)shareManager;</span><br><span class="line"></span><br><span class="line">- (void)addObject:(id)object;</span><br><span class="line"></span><br><span class="line">- (id)getObject;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>.m<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;JXMemoryCache.h&quot;</span><br><span class="line"></span><br><span class="line">@interface JXMemoryCache()</span><br><span class="line">@property (nonatomic, strong) NSMutableArray *caches;</span><br><span class="line">@end</span><br><span class="line">@implementation JXMemoryCache</span><br><span class="line"></span><br><span class="line">+ (instancetype)shareManager &#123;</span><br><span class="line">    static JXMemoryCache *cache = nil;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        cache = [[JXMemoryCache alloc]init];</span><br><span class="line">        cache.caches = [[NSMutableArray alloc]init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    return cache;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addObject:(id)object &#123;</span><br><span class="line">    JXMemoryCache *cache = [JXMemoryCache shareManager];</span><br><span class="line">    </span><br><span class="line">    [cache.caches addObject:object];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)getObject &#123;</span><br><span class="line">    JXMemoryCache *cache = [JXMemoryCache shareManager];</span><br><span class="line">    </span><br><span class="line">    return cache.caches;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>扩展补全这个类 再说吧</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/04/14/自定义模板/"><span>自定义模板</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/04/14/自定义模板/" rel="bookmark">
        <time class="entry-date published" datetime="2018-04-14T07:11:38.000Z">
          2018-04-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>1.首先找到系统模板路径，我的是xcode9。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/应用程序/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/Xcode/Templates/File Templates/Source/Cocoa Touch Class.xctemplate</span><br></pre></td></tr></table></figure>
<p>目录如下：</p>
<p><img src="https://raw.githubusercontent.com/wqforever/wqforever.github.io/master/image/97033637-E8DB-43A6-8EF1-8150750DF240.png" alt="Alt Text"></p>
<p>2.然后按规则创建文件夹 名字+Objective-c，再创建两个文件，名字是<strong>FILEBASENAME</strong>.h,__FILEBASENAME.m</p>
<p><img src="https://raw.githubusercontent.com/wqforever/wqforever.github.io/master/image/DDEB0040-7E14-45AE-ADE6-89A81FE8B845.png" alt="Alt Text"></p>
<p>3.然后修改文件里面内容<br>.h<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  ___FILENAME___</span><br><span class="line">//  ___PROJECTNAME___</span><br><span class="line">//</span><br><span class="line">//  Created by ___FULLUSERNAME___ on ___DATE___.</span><br><span class="line">//___COPYRIGHT___</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;JXBaseViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface ___FILEBASENAMEASIDENTIFIER___ : JXBaseViewController</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *url;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSDictionary *params;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>.m<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  ___FILENAME___</span><br><span class="line">//  ___PROJECTNAME___</span><br><span class="line">//</span><br><span class="line">//  Created by ___FULLUSERNAME___ on ___DATE___.</span><br><span class="line">//___COPYRIGHT___</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;___FILEBASENAME___.h&quot;</span><br><span class="line"></span><br><span class="line">// Controllers</span><br><span class="line"></span><br><span class="line">// Model</span><br><span class="line"></span><br><span class="line">// Views</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//#define &lt;#macro#&gt; &lt;#value#&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@interface ___FILEBASENAMEASIDENTIFIER___ ()</span><br><span class="line"></span><br><span class="line">//@property (nonatomic, strong) &lt;#type#&gt; *&lt;#name#&gt;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ___FILEBASENAMEASIDENTIFIER___</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - View Controller LifeCyle</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    [self initialNavigationBar];</span><br><span class="line">    [self initialUserInterface];</span><br><span class="line">    [self httpRequest];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewDidAppear:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidAppear:animated];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewWillDisappear:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    [super viewWillDisappear:animated];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - data</span><br><span class="line">- (void)httpRequest &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - ui</span><br><span class="line">- (void)initialUserInterface &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">#pragma mark - Initial Methods</span><br><span class="line"></span><br><span class="line">- (void)initialNavigationBar</span><br><span class="line">&#123;</span><br><span class="line">    //    self.navigationItem.title = &lt;#title#&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Override</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Target Methods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Notification Methods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - KVO Methods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Privater Methods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - Setter Getter Methods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - dealloc</span><br><span class="line">- (void)didReceiveMemoryWarning</span><br><span class="line">&#123;</span><br><span class="line">    [super didReceiveMemoryWarning];</span><br><span class="line">    </span><br><span class="line">    [[SDImageCache sharedImageCache] setValue:nil forKey:@&quot;memCache&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>4.修改TemplateInfo.plist里的值<br><img src="https://raw.githubusercontent.com/wqforever/wqforever.github.io/master/image/6466C6A5-1980-420B-8477-842E3079A70A.png" alt="Alt Text"></p>
<p><strong>踩下的坑：创建文件和修改plist先把文件复制到桌面创建修改好在替换里面的文件，直接修改里面的文件是不行的，即使把权限修改为读写也不行</strong></p>
<p>有啥问题联系我QQ597438567</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/04/14/面试题/"><span>面试题</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/04/14/面试题/" rel="bookmark">
        <time class="entry-date published" datetime="2018-04-14T01:21:07.000Z">
          2018-04-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>以下都是面试过程中遇到的问题，所以我尽量用口水话来描述，模拟当时的对话环境，因为不可能你给面试官直接看代码啊。</strong></p>
<h2 id="1-NSString用strong和copy的区别"><a href="#1-NSString用strong和copy的区别" class="headerlink" title="1.NSString用strong和copy的区别"></a>1.NSString用strong和copy的区别</h2><p>strong只是引用计数器+1，地址没变，copy是地址重新拷贝了一份</p>
<h2 id="2-delegate和block的区别"><a href="#2-delegate和block的区别" class="headerlink" title="2.delegate和block的区别"></a>2.delegate和block的区别</h2><p>这个虽然经常使用，被面试问到时，感觉不好用口水话直接说出来。<br>block是代码块，需要用的时候要从栈内存拷贝到堆内存，缺点是容易引起循环引用，可读性较好，效率高。<br>delegate只是保存了一个回调指针，要用时直接查表，消耗比block少，缺点是写着比block麻烦，可读性较差。</p>
<h2 id="3-delegate为什么用weak修饰"><a href="#3-delegate为什么用weak修饰" class="headerlink" title="3.delegate为什么用weak修饰"></a>3.delegate为什么用weak修饰</h2><p>ViewController通过strong指针拥有一个UITableview，tableview的datasource和delegate都是weak指针，指向ViewController，防止循环引用</p>
<h2 id="4-block为什么用copy修饰，为什么会产生循环引用，怎么解决"><a href="#4-block为什么用copy修饰，为什么会产生循环引用，怎么解决" class="headerlink" title="4.block为什么用copy修饰，为什么会产生循环引用，怎么解决"></a>4.block为什么用copy修饰，为什么会产生循环引用，怎么解决</h2><p>默认情况下，block是存档在栈中，可能被随时回收，通过copy操作可以使其在堆中保留一份, 相当于一直强引用着, 因此如果block中用到self时, 需要将其弱化, 通过<strong>weak或者</strong>unsafe_unretained.<br>A类持有block，block又持有A类，就会产生循环引用，还有可能多个类之间循环。<br>解决方案两个，一个是通过<strong>weak来修饰block，另一个方法是在block使用完之后主动把block==nil<br>新增block高级问题：<br>block的类型：<br>NSGlobalBlock<br>block 内部没有引用外部变量的 Block 类型都是 NSGlobalBlock 类型，存储于全局数据区，由系统管理其内存，retain、copy、release操作都无效。<br>NSStackBlock<br>block 内部引用外部变量，retain、release 操作无效，存储于栈区，变量作用域结束时，其被系统自动释放销毁。MRC 环境下，[[mutableAarry addObject: blockA]，（在arc中不用担心此问题，因为arc中会默认将实例化的block拷贝到堆上）在其所在作用域结束也就是函数出栈后，从mutableAarry中取到的blockA已经被回收，变成了野指针。正确的做法是先将blockA copy到堆上，然后加入数组。支持copy，copy之后生成新的NSMallocBlock类型对象。<br>NSMallocBlock<br>存储于堆区，支持retain、release，虽然 retainCount 始终是 1，但内存管理器中仍然会增加、减少计数，当引用计数为零的时候释放（可多次retain、release 操作验证）。copy之后不会生成新的对象，只是增加了一次引用，类似retain，尽量不要对Block使用retain操作。
</strong>block原理：<br>对象在block中复制了一份，转换成了<strong>Block_byref_val_0这样的结构体。没有用</strong>block修饰的变量，不能被捕获修改。<br><strong>block与</strong>weak的区别：<br><strong>weak本身是可以避免循环引用的问题的，但是其会导致外部对象释放了之后，block 内部也访问不到这个对象的问题，我们可以通过在 block 内部声明一个</strong>strong的变量来指向 weakObj，使外部对象既能在 block 内部保持住，又能避免循环引用的问题。</p>
<p><strong>block本身无法避免循环引用的问题，但是我们可以通过在 block 内部手动把 blockObj 赋值为 nil 的方式来避免循环引用的问题。另外一点就是</strong>block修饰的变量在 block 内外都是唯一的，要注意这个特性可能带来的隐患。<br>但是<strong>block有一点：这只是限制在ARC环境下。在非arc下，</strong>block是可以避免引用循环的</p>
<h2 id="5-tableview为什么会卡顿，怎么解决"><a href="#5-tableview为什么会卡顿，怎么解决" class="headerlink" title="5.tableview为什么会卡顿，怎么解决"></a>5.tableview为什么会卡顿，怎么解决</h2><p>1.提前计算并缓存好高度，因为heightForRow最频繁的调用。<br>2.异步绘制，遇到复杂界面，性能瓶颈时，可能是突破口。<br>3.滑动时按需加载，这个在大量图片展示，网络加载时，很管用。（SDWebImage已经实现异步加载）。<br>4.重用cells。<br>5.如果cell内显示得内容来自web，使用异步加载，缓存结果请求。<br>6.少用或不用透明图层，使用不透明视图。<br>7.尽量使所有的view opaque，包括cell本身。<br>8.减少subViews<br>9.少用addView给cell动态添加view，可以初始化的时候就添加，然后通过hide控制是否显示。</p>
<p>这个问题老生常谈，其实就一句话，减少cell里的操作，不管是计算还是渲染。</p>
<h2 id="6-app如何优化"><a href="#6-app如何优化" class="headerlink" title="6.app如何优化"></a>6.app如何优化</h2><p>1、网络性能优化<br>2、内存优化<br>3、卡顿，一般检测runloop里一个循环超过2s就说明卡顿了，需要检查：网络同步请求，I/O操作，大量运算，解压缩等<br>4、离屏渲染，减少圆角、透明、阴影、光栅化、遮罩、渐变等操作<br>5、重用大开销的对象，NSDateFormat<br>6、app启动加速</p>
<h2 id="7-如何检测内存泄漏，怎么处理，oc如何管理内存等"><a href="#7-如何检测内存泄漏，怎么处理，oc如何管理内存等" class="headerlink" title="7.如何检测内存泄漏，怎么处理，oc如何管理内存等"></a>7.如何检测内存泄漏，怎么处理，oc如何管理内存等</h2><p>使用instrument，定位到内存泄漏的地方<br>1、循环引用<br>2、无限循环<br>3、NSNotificationCenter，KVO 问题，需要在dealloc移除<br>4、NSTimer Animator 需要在dealloc停止</p>
<h2 id="8-如何解决崩溃"><a href="#8-如何解决崩溃" class="headerlink" title="8.如何解决崩溃"></a>8.如何解决崩溃</h2><p>利用runtime把容易的崩溃的方法做易错处理后更换。</p>
<h2 id="9-app安全性"><a href="#9-app安全性" class="headerlink" title="9.app安全性"></a>9.app安全性</h2><p>用https，信息加密，代码混淆等</p>
<h2 id="10-数据缓存"><a href="#10-数据缓存" class="headerlink" title="10.数据缓存"></a>10.数据缓存</h2><p>归解档<br>NSUserDefaults<br>plist<br>sqlite</p>
<h2 id="11-timer准不准，如何弄一个准确的timer"><a href="#11-timer准不准，如何弄一个准确的timer" class="headerlink" title="11.timer准不准，如何弄一个准确的timer"></a>11.timer准不准，如何弄一个准确的timer</h2><p>不准，当程序卡顿runloop有卡顿的时候，timer会停止计数<br>使用mach内核级的函数可以使用mach_absolute_time()获取到CPU的tickcount的计数值可以实现准确的timer</p>
<h2 id="12-oc字典的实现原理，扩容原理"><a href="#12-oc字典的实现原理，扩容原理" class="headerlink" title="12.oc字典的实现原理，扩容原理"></a>12.oc字典的实现原理，扩容原理</h2><p>底层是用hash表来实现的，扩容是当负载因子达到0.75-1的时候，hash表会扩容一倍，数量会是在2^n-1<br>以上是我这2周面试来有印象的几个问题，每个问题都可以引申出很多问题，如果只了解一点，是会被问懵逼的。</p>
<p>还有一些问题，比如你为什么辞职，你平时通过什么学习，你有github 博客吗，你自己的发展路径等等这些问题，见仁见智，主要就是考察你的学习性，主观能动性，还有解决问题的能力。只要回答的方向能展示出你的这些能力还是很受面试官的青睐的。<br>这两周，有4个面试，拿了3个offer，有一个是做视频的，对视频处理不是特别了解，所以挂了，普遍都聊到了，iOS可能现在比较饱和，企业想招的人都是3-5年的，以后趋势基本是大前端的趋势。也是对自己以后学习的方向有一个确定吧，以iOS为中心，先学习前端再安卓，不能一棵树吊死了。<del>毕竟苹果药丸每年都在说，哈哈。</del></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 王琪
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>